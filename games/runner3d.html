<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Runner 3D</title>
  <style>
    body { margin: 0; overflow: hidden; background: #0f172a; }
    #ui {
      position: absolute; top: 10px; left: 50%;
      transform: translateX(-50%);
      color: white; font-family: sans-serif;
      font-size: 20px; z-index: 10;
    }
    #gameOver {
      display: none;
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%,-50%);
      background: rgba(0,0,0,0.8);
      padding: 20px; border-radius: 12px; text-align: center; color:white;
    }
    button {
      margin-top: 10px; padding: 10px 16px;
      background: #4f46e5; border: none; border-radius: 8px;
      color: #fff; font-weight: bold; cursor: pointer;
    }
    /* Mobil kontrol */
    #jumpBtn {
      position: absolute; bottom: 20px; right: 20px;
      width: 80px; height: 80px;
      background: rgba(255,255,255,0.2);
      border: 2px solid #fff; border-radius: 50%;
      font-size: 20px; color: #fff;
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
    }
    #jumpBtn:active { background: rgba(255,255,255,0.4); }
  </style>
</head>
<body>
<div id="ui">Skor: <span id="score">0</span></div>
<div id="gameOver">
  <h2>Oyun Bitti</h2>
  <p>Skorun: <span id="finalScore"></span></p>
  <button onclick="restartGame()">Tekrar Oyna</button>
</div>
<div id="jumpBtn">⤴</div>

<!-- Three.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>

<script>
let scene, camera, renderer, clock;
let player, floor;
let obstacles = [];
let score = 0, gameRunning = true;

init();
animate();

function init(){
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0f172a);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(0,3,6);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Işıklar
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5,10,5);
  scene.add(light);

  // Zemin
  const floorGeo = new THREE.PlaneGeometry(20,1000);
  const floorMat = new THREE.MeshStandardMaterial({color:0x1e293b});
  floor = new THREE.Mesh(floorGeo, floorMat);
  floor.rotation.x = -Math.PI/2;
  scene.add(floor);

  // Oyuncu (küp)
  const playerGeo = new THREE.BoxGeometry(1,1,1);
  const playerMat = new THREE.MeshStandardMaterial({color:0x10b981});
  player = new THREE.Mesh(playerGeo, playerMat);
  player.position.set(0,0.5,0);
  scene.add(player);

  // Saat
  clock = new THREE.Clock();

  // Olaylar
  document.addEventListener("keydown", (e)=>{
    if(e.code === "Space") jump();
  });
  document.getElementById("jumpBtn").addEventListener("click", jump);

  window.addEventListener("resize", ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}

let velocityY = 0;
function jump(){
  if(!gameRunning) return;
  if(player.position.y <= 0.51){
    velocityY = 0.2;
  }
}

function spawnObstacle(){
  const geo = new THREE.BoxGeometry(1,1,1);
  const mat = new THREE.MeshStandardMaterial({color:0xef4444});
  const obs = new THREE.Mesh(geo, mat);
  obs.position.set((Math.random()*6)-3,0.5,-50);
  scene.add(obs);
  obstacles.push(obs);
}

function resetGame(){
  obstacles.forEach(o=>scene.remove(o));
  obstacles = [];
  score = 0;
  player.position.set(0,0.5,0);
  velocityY = 0;
  gameRunning = true;
  document.getElementById("gameOver").style.display="none";
}

function restartGame(){
  resetGame();
}

function animate(){
  requestAnimationFrame(animate);
  if(!gameRunning){
    renderer.render(scene,camera);
    return;
  }

  const delta = clock.getDelta();

  // Player gravity
  velocityY -= 0.01;
  player.position.y += velocityY;
  if(player.position.y < 0.5){
    player.position.y = 0.5;
    velocityY = 0;
  }

  // Obstacles hareketi
  for(let i=obstacles.length-1;i>=0;i--){
    obstacles[i].position.z += 0.3;
    if(obstacles[i].position.z > 10){
      scene.remove(obstacles[i]);
      obstacles.splice(i,1);
      score++;
      document.getElementById("score").innerText = score;
    }
    // Çarpışma
    if(Math.abs(obstacles[i].position.z - player.position.z) < 0.6 &&
       Math.abs(obstacles[i].position.x - player.position.x) < 0.8 &&
       Math.abs(obstacles[i].position.y - player.position.y) < 0.8){
         gameRunning = false;
         document.getElementById("finalScore").innerText = score;
         document.getElementById("gameOver").style.display="block";
    }
  }

  // Rastgele engel oluştur
  if(Math.random()<0.02){
    spawnObstacle();
  }

  renderer.render(scene,camera);
}
</script>
</body>
</html>
