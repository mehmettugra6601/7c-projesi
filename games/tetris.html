<!DOCTYPE html>
<html lang="tr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Tetris</title>
<style>
  body{margin:0;background:#0b1020;color:#fff;font-family:system-ui}
  .wrap{display:grid;place-items:center;min-height:100vh;padding:16px}
  canvas{background:#000;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,.4)}
  .hud{position:fixed;top:10px;left:10px;background:#0009;padding:8px 12px;border-radius:10px}
  .touch{position:fixed;bottom:20px;left:0;right:0;display:flex;justify-content:center;gap:12px}
  .touch button{padding:12px 14px;border-radius:12px;border:none;background:#fff;color:#111;font-weight:700}
</style></head>
<body>
<div class="wrap"><canvas id="c" width="240" height="480"></canvas></div>
<div class="hud">Skor: <span id="sc">0</span></div>
<div class="touch">
  <button id="left">←</button><button id="rot">⟳</button><button id="right">→</button><button id="down">↓</button>
</div>
<script>
const W=10,H=20,S=24;
const cvs=document.getElementById('c'),ctx=cvs.getContext('2d');
let arena = Array.from({length:H}, ()=> Array(W).fill(0));
const SHAPES = {
  I:[[1,1,1,1]],
  O:[[2,2],[2,2]],
  T:[[0,3,0],[3,3,3]],
  L:[[0,0,4],[4,4,4]],
  J:[[5,0,0],[5,5,5]],
  S:[[0,6,6],[6,6,0]],
  Z:[[7,7,0],[0,7,7]]
};
const COLORS=['#000','#00f0ff','#ffe066','#bf5af2','#ff9f1a','#64d2ff','#34c759','#ff453a'];
let piece, pos, score=0, dropCounter=0, dropInterval=700, last=0, running=true;
function newPiece(){
  const keys=Object.keys(SHAPES), k=keys[(Math.random()*keys.length)|0];
  const m=SHAPES[k].map(r=>r.slice()); piece=m; pos={x:(W/2|0)-(piece[0].length/2|0), y:0};
  if(collide()){ running=false; over(); }
}
function rotate(dir){
  // transpose + reverse rows/cols
  for(let y=0;y<piece.length;y++) for(let x=0;x<y;x++) [piece[x][y],piece[y][x]]=[piece[y][x],piece[x][y]];
  if(dir>0) piece.forEach(r=>r.reverse()); else { piece.reverse(); }
  if(collide()){ // duvara takılma düzeltmesi
    pos.x+=1; if(collide()) pos.x-=2; if(collide()){ pos.x+=1; // geri al
      rotate(-dir);
    }
  }
}
function merge(){
  piece.forEach((row,y)=>row.forEach((v,x)=>{ if(v) arena[y+pos.y][x+pos.x]=v; }));
}
function collide(){
  for(let y=0;y<piece.length;y++) for(let x=0;x<piece[y].length;x++){
    if(piece[y][x] && (arena[y+pos.y]?.[x+pos.x]??1)) return true;
  }
  return false;
}
function sweep(){
  let lines=0;
  outer: for(let y=H-1;y>=0;--y){
    for(let x=0;x<W;++x){ if(!arena[y][x]) continue outer; }
    const row=arena.splice(y,1)[0].fill(0); arena.unshift(row); y++; lines++;
  }
  if(lines){ score+= [0,100,300,500,800][lines]; document.getElementById('sc').textContent=score; dropInterval=Math.max(120, dropInterval-20*lines); }
}
function drawMatrix(m,off){ m.forEach((row,y)=>row.forEach((v,x)=>{ if(!v) return; ctx.fillStyle=COLORS[v]; ctx.fillRect((x+off.x)*S,(y+off.y)*S,S-1,S-1); })); }
function draw(){
  ctx.fillStyle='#000'; ctx.fillRect(0,0,cvs.width,cvs.height);
  drawMatrix(arena,{x:0,y:0}); drawMatrix(piece,pos);
}
function update(t=0){
  if(!running) return;
  const dt=t-last; last=t; dropCounter+=dt;
  if(dropCounter>dropInterval){ pos.y++; if(collide()){ pos.y--; merge(); sweep(); newPiece(); } dropCounter=0; }
  draw(); requestAnimationFrame(update);
}
function over(){
  ctx.fillStyle='rgba(0,0,0,.6)'; ctx.fillRect(0,0,cvs.width,cvs.height);
  ctx.fillStyle='#fff'; ctx.font='20px system-ui'; ctx.fillText('Oyun Bitti! Skor: '+score, 40, 220);
  ctx.fillText('SPACE ile tekrar', 60, 250);
}
function move(dx){ pos.x+=dx; if(collide()) pos.x-=dx; }
function drop(){ pos.y++; if(collide()){ pos.y--; merge(); sweep(); newPiece(); } dropCounter=0; }
window.addEventListener('keydown',e=>{
  if(!running && e.key===' ') { arena=Array.from({length:H},()=>Array(W).fill(0)); score=0; dropInterval=700; running=true; newPiece(); update(); return; }
  if(e.key==='ArrowLeft') move(-1);
  else if(e.key==='ArrowRight') move(1);
  else if(e.key==='ArrowDown') drop();
  else if(e.key==='ArrowUp') rotate(1);
});
document.getElementById('left').addEventListener('click',()=>move(-1));
document.getElementById('right').addEventListener('click',()=>move(1));
document.getElementById('down').addEventListener('click',drop);
document.getElementById('rot').addEventListener('click',()=>rotate(1));
newPiece(); update();
</script>
</body></html>
